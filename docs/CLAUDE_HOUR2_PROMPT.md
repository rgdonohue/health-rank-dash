# Claude Hour 2 Prompt - TDD API Development

Copy and paste this prompt to Claude after Hour 1 (ETL + Validation) is complete:

---

## üéØ HealthRankDash Hour 2 - TDD API Development

Excellent work on Hour 1! You should now have a working ETL pipeline that parses County Health Rankings data and generates a validated indicator catalog. Time to build the FastAPI backend that will serve this data to users.

## ‚ö° HOUR 2 TARGET: Complete FastAPI Backend with 100% Test Coverage

### üîç QUICK STATUS CHECK (2 minutes):

Before starting, verify Hour 1 completions:
```bash
# Confirm virtual environment is still active
which python  # Should show venv path

# Check git status
git log --oneline -5  # Should see meaningful commits from Hour 1
git status  # Should be clean

# Verify core components exist
ls -la data/etl/  # Should see parser.py and other ETL modules
pytest --cov  # Should show 90%+ coverage on ETL code
```

If anything is missing, address it before proceeding.

## üéØ YOUR MISSION FOR HOUR 2 (Next 60 Minutes):

### Phase 1: API Architecture Setup (10 minutes)
- Create `backend/api/` directory structure
- Set up FastAPI application with proper configuration
- Implement dependency injection for ETL components
- **Git commit**: "Initialize FastAPI application structure with DI pattern"

### Phase 2: Core API Endpoints (25 minutes)
Build these RESTful endpoints following TDD principles:

#### Required Endpoints:
1. **GET /health** - API health check
2. **GET /indicators** - List all available health indicators
3. **GET /states** - List all available states
4. **GET /counties/{state}** - List counties for a given state
5. **GET /data** - Main data endpoint with query parameters:
   - `?state=Ohio&year=2025&indicator=v001`
   - `?fipscode=39001&year=2025&indicator=v023`
   - `?state=Ohio&year=2025` (all indicators)

#### Response Format:
```json
{
  "data": [
    {
      "fipscode": "39001",
      "state": "Ohio", 
      "county": "Adams County",
      "year": 2025,
      "indicator": "v001",
      "indicator_name": "Health Outcome Measure",
      "rawvalue": 85.2,
      "numerator": 1234,
      "denominator": 1448,
      "ci_low": 82.1,
      "ci_high": 88.3,
      "confidence_intervals_available": true
    }
  ],
  "metadata": {
    "total_records": 1,
    "query_time_ms": 45,
    "data_source": "County Health Rankings 2025"
  }
}
```

**Git commit**: "Implement core API endpoints with query parameter filtering"

### Phase 3: Test-Driven Development (20 minutes)
Write comprehensive tests for EVERY endpoint:

#### Test Categories:
- **Unit Tests**: Individual endpoint logic
- **Integration Tests**: Full request/response cycles
- **Edge Case Tests**: Invalid parameters, missing data, malformed requests
- **Performance Tests**: Response time validation (<500ms requirement)

#### Test Examples:
```python
def test_health_endpoint_returns_200():
    """Health check should always return 200 OK"""
    
def test_data_endpoint_filters_by_state():
    """Data endpoint should filter correctly by state parameter"""
    
def test_data_endpoint_handles_invalid_fipscode():
    """Should return 400 for invalid FIPS codes"""
    
def test_api_response_time_under_500ms():
    """All endpoints should respond within 500ms"""
```

**Target**: 100% test coverage on all API endpoints
**Git commit**: "Add comprehensive API test suite - 100% coverage achieved"

### Phase 4: Error Handling & Validation (5 minutes)
- Implement proper HTTP status codes (200, 400, 404, 422, 500)
- Add request validation using Pydantic models
- Handle edge cases gracefully (missing data, invalid parameters)
- **Git commit**: "Add robust error handling and request validation"

## üìã SUCCESS CRITERIA FOR HOUR 2:

- [ ] FastAPI application running locally on localhost:8000
- [ ] All 5 core endpoints implemented and working
- [ ] 100% test coverage on API layer
- [ ] Response times <500ms for all endpoints
- [ ] Proper error handling with appropriate HTTP status codes
- [ ] API documentation auto-generated by FastAPI
- [ ] Git commits every 10-15 minutes with meaningful messages

## üß≠ KEY RESOURCES TO USE:

1. **API Requirements**: PRD.md sections 5-6 for endpoint specifications
2. **Error Handling**: PRD.md section 9 for error patterns
3. **Performance Targets**: Sub-500ms response time requirement
4. **Testing Strategy**: Comprehensive test types defined in PRD section 12

## ‚ö†Ô∏è CRITICAL REMINDERS:

- **TEST FIRST**: Write tests before implementing each endpoint (TDD)
- **VALIDATE INPUT**: Use Pydantic models for all request validation
- **HANDLE ERRORS**: Graceful degradation for missing/invalid data
- **PERFORMANCE**: Profile response times and optimize if needed
- **SECURITY**: Basic input sanitization and validation

## üöÄ QUICK START COMMANDS:

```bash
# Install additional API dependencies
pip install "fastapi[all]" pydantic pytest-asyncio httpx

# Create API structure
mkdir -p backend/api backend/models backend/services
touch backend/__init__.py backend/api/__init__.py

# Run API during development
uvicorn backend.api.main:app --reload --port 8000

# Test the API
pytest backend/tests/ --cov=backend --cov-report=html
```

## üìä TRACK THESE METRICS:
- API endpoint implementation time
- Test coverage percentage (target: 100%)
- Average response time per endpoint
- Number of edge cases handled
- Git commits made (target: 4-6 commits)

## üéØ EXPECTED DELIVERABLES:

By the end of Hour 2, you should have:
1. **Working FastAPI application** serving County Health Rankings data
2. **Complete test suite** with 100% coverage
3. **API documentation** accessible at http://localhost:8000/docs
4. **Performance validation** showing <500ms response times
5. **Error handling** for all common failure modes

## üß™ TESTING YOUR API:

Once implemented, test with these sample requests:
```bash
# Health check
curl http://localhost:8000/health

# Get all indicators
curl http://localhost:8000/indicators

# Get Ohio counties data for indicator v001
curl "http://localhost:8000/data?state=Ohio&year=2025&indicator=v001"

# Get specific county by FIPS code
curl "http://localhost:8000/data?fipscode=39001&year=2025"
```

## üîÑ IF ISSUES ARISE:

- **ETL Integration Problems**: Verify Hour 1 completions first
- **Performance Issues**: Profile with pytest-benchmark
- **Test Failures**: Fix tests before adding new features
- **Import Errors**: Check virtual environment activation

## üìù LOGGING REQUIREMENTS:

Continue using the enhanced CLAUDE.md template to document:
- API design decisions and trade-offs
- Performance optimization strategies
- Test coverage achievements
- Any issues encountered and solutions

**Remember**: We're building production-quality code at rapid pace. Quality and test coverage are non-negotiable even with the accelerated timeline.

Ready to build an amazing API? Let's make it happen! üöÄ 